<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../favicon.svg">
<title>userver: dist_lock::DistLockedWorker Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<link rel="stylesheet" href="../../doxygen-like.css">
<script src="../../highlight.pack.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a class="titlelink" href="../../index.html">userver
   </a>
   </div>
   <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework (beta)</a></div>
  </td>
  <td style="float: right; padding-right: 40px; padding-top: 15px;">
    <a href="https://github.com/userver-framework/userver" rel="noopener" target="_blank" class="titlelink">
      <img src="../../github_logo.svg" alt="Github"/>
    </a>
    &nbsp;
    <a href="https://t.me/+i3k5A6V0oFgwNmYy" rel="noopener" id='telegram_channel' target="_blank" class="titlelink">
      <img src="../../telegram_logo.svg" alt="Telegram"/>
    </a>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../da/d4a/namespacedist__lock.html">dist_lock</a></li><li class="navelem"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html">DistLockedWorker</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="../../dc/d22/classdist__lock_1_1DistLockedWorker-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">dist_lock::DistLockedWorker Class Reference<span class="mlabels"><span class="mlabel">final</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="../../d8/ded/dist__locked__worker_8hpp_source.html">userver/dist_lock/dist_locked_worker.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:ab39daa651286f7b6fa5810fae19810ae"><td class="memItemLeft" align="right" valign="top"><a id="ab39daa651286f7b6fa5810fae19810ae"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>WorkerFunc</b> = std::function&lt; void()&gt;</td></tr>
<tr class="separator:ab39daa651286f7b6fa5810fae19810ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2a6f1888695203669be0b03d4838d4c4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#a2a6f1888695203669be0b03d4838d4c4">DistLockedWorker</a> (std::string name, WorkerFunc worker_func, std::shared_ptr&lt; <a class="el" href="../../d9/d8e/classdist__lock_1_1DistLockStrategyBase.html">DistLockStrategyBase</a> &gt; strategy, const <a class="el" href="../../dd/d91/structdist__lock_1_1DistLockSettings.html">DistLockSettings</a> &amp;settings={}, engine::TaskProcessor *task_processor=nullptr)</td></tr>
<tr class="separator:a2a6f1888695203669be0b03d4838d4c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbe450e4b339521a67f5028b4d4ec06e"><td class="memItemLeft" align="right" valign="top"><a id="abbe450e4b339521a67f5028b4d4ec06e"></a>
const std::string &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#abbe450e4b339521a67f5028b4d4ec06e">Name</a> () const</td></tr>
<tr class="memdesc:abbe450e4b339521a67f5028b4d4ec06e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name of the worker. <br /></td></tr>
<tr class="separator:abbe450e4b339521a67f5028b4d4ec06e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb813b28b296ecaddab6324a89a28c86"><td class="memItemLeft" align="right" valign="top"><a id="afb813b28b296ecaddab6324a89a28c86"></a>
<a class="el" href="../../dd/d91/structdist__lock_1_1DistLockSettings.html">DistLockSettings</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#afb813b28b296ecaddab6324a89a28c86">GetSettings</a> () const</td></tr>
<tr class="memdesc:afb813b28b296ecaddab6324a89a28c86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves settings in a thread-safe way. <br /></td></tr>
<tr class="separator:afb813b28b296ecaddab6324a89a28c86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace9c554d5e3ebf73ccfffa141d0b49d6"><td class="memItemLeft" align="right" valign="top"><a id="ace9c554d5e3ebf73ccfffa141d0b49d6"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#ace9c554d5e3ebf73ccfffa141d0b49d6">UpdateSettings</a> (const <a class="el" href="../../dd/d91/structdist__lock_1_1DistLockSettings.html">DistLockSettings</a> &amp;)</td></tr>
<tr class="memdesc:ace9c554d5e3ebf73ccfffa141d0b49d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update settings in a thread-safe way. <br /></td></tr>
<tr class="separator:ace9c554d5e3ebf73ccfffa141d0b49d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc99d41e7d336d06b54f6e612bc941ad"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#adc99d41e7d336d06b54f6e612bc941ad">Start</a> ()</td></tr>
<tr class="separator:adc99d41e7d336d06b54f6e612bc941ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22da82d3c0dd477df5f419563610bfe7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#a22da82d3c0dd477df5f419563610bfe7">Stop</a> ()</td></tr>
<tr class="separator:a22da82d3c0dd477df5f419563610bfe7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a628dd79a2f16af07cadb2b486b321be3"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#a628dd79a2f16af07cadb2b486b321be3">IsRunning</a> () const</td></tr>
<tr class="separator:a628dd79a2f16af07cadb2b486b321be3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad94ac61f1f880d16b2b443c755cb67df"><td class="memItemLeft" align="right" valign="top">std::optional&lt; std::chrono::steady_clock::duration &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#ad94ac61f1f880d16b2b443c755cb67df">GetLockedDuration</a> () const</td></tr>
<tr class="separator:ad94ac61f1f880d16b2b443c755cb67df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a754282135d57ecb0243fa94c7bf1eeed"><td class="memItemLeft" align="right" valign="top"><a id="a754282135d57ecb0243fa94c7bf1eeed"></a>
const <a class="el" href="../../d2/de5/structdist__lock_1_1Statistics.html">Statistics</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#a754282135d57ecb0243fa94c7bf1eeed">GetStatistics</a> () const</td></tr>
<tr class="memdesc:a754282135d57ecb0243fa94c7bf1eeed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns lock acquisition statistics. <br /></td></tr>
<tr class="separator:a754282135d57ecb0243fa94c7bf1eeed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62f07bd9b35aefe9fc64298fe541d862"><td class="memItemLeft" align="right" valign="top"><a id="a62f07bd9b35aefe9fc64298fe541d862"></a>
<a class="el" href="../../de/d91/classformats_1_1json_1_1Value.html">formats::json::Value</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#a62f07bd9b35aefe9fc64298fe541d862">GetStatisticsJson</a> () const</td></tr>
<tr class="memdesc:a62f07bd9b35aefe9fc64298fe541d862"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return formatted statistics JSON. <br /></td></tr>
<tr class="separator:a62f07bd9b35aefe9fc64298fe541d862"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A high-level primitive that perpetually tries to acquire a distributed lock and runs user callback in a separate task while the lock is held. Cancels the task when the lock is lost. </p>

<p class="definition">Definition at line <a class="el" href="../../d8/ded/dist__locked__worker_8hpp_source.html#l00028">28</a> of file <a class="el" href="../../d8/ded/dist__locked__worker_8hpp_source.html">dist_locked_worker.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2a6f1888695203669be0b03d4838d4c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a6f1888695203669be0b03d4838d4c4">&#9670;&nbsp;</a></span>DistLockedWorker()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dist_lock::DistLockedWorker::DistLockedWorker </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">WorkerFunc&#160;</td>
          <td class="paramname"><em>worker_func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="../../d9/d8e/classdist__lock_1_1DistLockStrategyBase.html">DistLockStrategyBase</a> &gt;&#160;</td>
          <td class="paramname"><em>strategy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../dd/d91/structdist__lock_1_1DistLockSettings.html">DistLockSettings</a> &amp;&#160;</td>
          <td class="paramname"><em>settings</em> = <code>{}</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">engine::TaskProcessor *&#160;</td>
          <td class="paramname"><em>task_processor</em> = <code>nullptr</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a <a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html">DistLockedWorker</a>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name of the worker </td></tr>
    <tr><td class="paramname">worker_func</td><td>a callback that's started each time we acquire the lock and is cancelled when the lock is lost. </td></tr>
    <tr><td class="paramname">settings</td><td>distributed lock settings </td></tr>
    <tr><td class="paramname">strategy</td><td>distributed locking strategy </td></tr>
    <tr><td class="paramname">task_processor</td><td>TaskProcessor for running <code>worker_func</code>, using current TaskProcessor if <code>nullptr</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><code>worker_func</code> must honour task cancellation and stop ASAP when it is cancelled, otherwise brain split is possible (IOW, two different users do work assuming both of them hold the lock, which is not true). </dd></dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ad94ac61f1f880d16b2b443c755cb67df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad94ac61f1f880d16b2b443c755cb67df">&#9670;&nbsp;</a></span>GetLockedDuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt;std::chrono::steady_clock::duration&gt; dist_lock::DistLockedWorker::GetLockedDuration </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns for how long the lock is held (if held at all). Returned value may be less than the real duration. </p>

</div>
</div>
<a id="a628dd79a2f16af07cadb2b486b321be3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a628dd79a2f16af07cadb2b486b321be3">&#9670;&nbsp;</a></span>IsRunning()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool dist_lock::DistLockedWorker::IsRunning </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="section return"><dt>Returns</dt><dd>whether the <a class="el" href="../../db/d9d/classdist__lock_1_1DistLockedTask.html">DistLockedTask</a> is started. </dd></dl>

</div>
</div>
<a id="adc99d41e7d336d06b54f6e612bc941ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc99d41e7d336d06b54f6e612bc941ad">&#9670;&nbsp;</a></span>Start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dist_lock::DistLockedWorker::Start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Starts acquiring the lock. Please note that it's possible that the lock is acquired and the WorkerFunc is entered <em>before</em> <a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#adc99d41e7d336d06b54f6e612bc941ad">Start()</a> returns. </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="../../db/d9d/classdist__lock_1_1DistLockedTask.html#a1f9b35564f90b9c20d7dd885196d6170">DistLockedTask::DistLockedTask</a> </dd></dl>

</div>
</div>
<a id="a22da82d3c0dd477df5f419563610bfe7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22da82d3c0dd477df5f419563610bfe7">&#9670;&nbsp;</a></span>Stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dist_lock::DistLockedWorker::Stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Stops acquiring the lock. It is guaranteed that the lock is not held after <a class="el" href="../../d4/d24/classdist__lock_1_1DistLockedWorker.html#a22da82d3c0dd477df5f419563610bfe7">Stop()</a> return and WorkerFunc is stopped (if was started). </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>userver/dist_lock/<a class="el" href="../../d8/ded/dist__locked__worker_8hpp_source.html">dist_locked_worker.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
<a id='page_edit' style="float:left; padding-left: 7pt;" href="#">‚öí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</a>
<address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
<script type="text/javascript">
const LOWER_CASE_TRANSLITTERATION_MAPPING = {
    "–∞":"a", "–±":"b", "–≤":"v", "–≥":"g", "–¥":"d", "–µ":"e", "—ë":"jo", "–∂":"zh",
    "–∑":"z", "–∏":"i", "–π":"jj", "–∫":"k", "–ª":"l", "–º":"m", "–Ω":"n", "–æ":"o",
    "–ø":"p", "—Ä":"r", "—Å":"s", "—Ç":"t", "—É":"u", "—Ñ":"f", "—Ö":"x", "—Ü":"c",
    "—á":"ch", "—à":"sh", "—â":"shh", "—ä":"\'", "—ã":"y", "—å":"\'", "—ç":"je",
    "—é":"ju", "—è":"ja"
};
const DOXYGEN_DIAMOND_STRING = '‚óÜ\u00A0' // ‚óÜ&nbsp;
function make_id(raw_id) {
    return raw_id.toLowerCase().split('').map(function (char) {
        return LOWER_CASE_TRANSLITTERATION_MAPPING[char] || char;
    }).join('').replace(/\W/g, '');
}
const html_escape = function () {
    const p = document.createElement('p');
    return function (text) {
        p.textContent = text;
        return p.innerHTML;
    };
}();
function setup_page_edit() {
    let href = window.location.href;
    const idx = href.indexOf('md_ru_');
    if (idx === -1) {
        $('#page_edit').hide();
        return;
    }
    href = href.substring(idx).split('.html')[0];
    href = href.split('#')[0];
    href = href.replace('md_ru_', 'https://wiki.yandex-team.ru/taxi/backend/');
    href = href.replaceAll('_', '/');
    $('#page_edit').attr("href", href + '/.edit');
}
function draw_toc() {
    let headers = $(':header');
    if (headers.length === 0) {
        return;
    }
    let sidenav_content = '<div id="mySidenav" class="sidenav">';
    sidenav_content += '<h2>Table of contents</h2>';
    headers.each(function() {
        let index = parseInt(this.nodeName.substring(1)) - 1;
        const header = $(this);
        let id = header.attr('id');
        if (!id) {
          id = make_id(header.text())
          header.attr('id', id);
        }
        let header_text = header.text()
        if (header_text.startsWith(DOXYGEN_DIAMOND_STRING)) {
            ++index;
            header_text = header_text.substring(DOXYGEN_DIAMOND_STRING.length);
        }
        sidenav_content += ''
          + '<a href="#' + id + '" style="padding-left: ' + index * 15 + 'px">'
          + '‚Ä¢&nbsp;' + html_escape(header_text)
          + '</a>'
        ;
        header.append(' <a class="hoverlink" href="#' + id + '">üîó</a>')
    });
    sidenav_content += '</div>';
    $(sidenav_content).insertAfter('.header');
}
function highlight_code() {
    if (window.location.href.indexOf("pp_source") !== -1
        || window.location.href.indexOf("cpp-example") !== -1) {
        // Header listing is already nicely highlighted by Doxygen
        return;
    }
    hljs.configure({
        tabReplace: '    ' // 4 spaces
    });
    hljs.registerAliases('py', {languageName: 'python'});
    hljs.registerAliases('sh', {languageName: 'shell'});
    hljs.registerAliases('bash', {languageName: 'shell'});
    hljs.registerAliases('yml', {languageName: 'yaml'});
    hljs.registerAliases('plain', {languageName: 'plaintext'});
    hljs.registerAliases('tskv', {languageName: 'plaintext'});
    $(".fragment").each(function() {
        const node = $(this);
        let data = '';
        let language = '';
        let requires_higlighting = true;
        node.children('div.line').each(function(i) {
            line = $(this).text();
            // Doxygen 1.8.11 workaround to remove line numbers.
            // No line numbers added in Doxygen 1.8.13
            line = line.replace(/^ *\d+\xA0/, '');
            if (i === 0) {
                line = line.trimLeft().replace(/^# /, '');
                if (line === 'autodetect') {
                    return true;
                } else if (hljs.getLanguage(line)) {
                    language = line;
                    return true;
                } else {
                    requires_higlighting = false;
                    return false;
                }
            }
            data += line + '\n';
        });
        if (requires_higlighting === false) {
            return;
        }
        if (language !== '') {
            data = hljs.highlight(language, data).value;
        } else {
            data = hljs.highlightAuto(data).value;
        }
        node.replaceWith('<div class="fragment"><pre>' + data + '</pre></div>');
    });
}
function setup_if_landing() {
    if (document.getElementById('landing_logo_id') === null) {
        return false;
    }
    $('#titlearea').hide();
    const main_nav = $('#main-nav')
    main_nav.addClass('main-nav-landing');
    main_nav.append('<hr>');
    $('.header').hide();
    $('body').css('background-color', 'black');
    $('#page_edit').hide();
    return true;
}
function sticky_menu() {
    const main_nav = $('#main-nav');
    const menu_y_position = 94;
    const search_results_window = $('#MSearchResultsWindow');
    var menu_is_sticky = false;
    const stick = function () {
        if ($(this).scrollTop() > menu_y_position) {
            if (menu_is_sticky) return;
            search_results_window.addClass('stickySearchResults');
            main_nav.addClass('stickyHeader');
            menu_is_sticky = true;
        } else {
            if (!menu_is_sticky) return;
            search_results_window.removeClass('stickySearchResults');
            // 'top' property of the results window is computed by Doxygen JS
            // and it may give bad results if the computation is invoked at the
            // middle of the page.
            //
            // Hiding the window. Doxygen will recompute and show it on new
            // user input.
            search_results_window.hide();
            main_nav.removeClass('stickyHeader');
            menu_is_sticky = false;
        }
    };
    stick();  // on page refresh draw the menu on a right position
    $(window).on("scroll", stick);
}
function telegram_channel_language() {
  if (/^ru/.test(navigator.language)) {
    const channel = $('#telegram_channel');
    if (channel) {
      channel.attr('href', 'https://t.me/+AdadhDPVG5xhNWRi');
    }
  }
}
$(function() {
    if (setup_if_landing()) return;
    draw_toc();
    highlight_code();
    setup_page_edit();
    telegram_channel_language();
    sticky_menu();
});
</script>
</body>
</html>
